<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>My Advanced Snippet App (Improved)</title>
  <style>
    /* Basic Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Header */
    header {
      background-color: #2c3e50;
      color: #ecf0f1;
      padding: 1rem;
    }
    header h1 {
      margin: 0;
    }

    /* Main layout: sidebar + content */
    main {
      flex: 1;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: #34495e;
      color: #ecf0f1;
      padding: 1rem;
    }
    .sidebar button {
      display: block;
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #2ecc71;
      color: #fff;
      transition: background-color 0.3s;
    }
    .sidebar button:hover {
      background-color: #27ae60;
    }

    /* Main content area */
    .content {
      flex: 1;
      padding: 1rem 2rem;
      background: #fff;
    }

    /* By default, hide all sections */
    .section {
      display: none;
    }
    /* When we need to show a section, we remove 'display: none' */
    .section.active {
      display: block;
    }

    /* Search bar styles */
    .search-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 1rem;
    }
    .search-bar input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .search-bar button {
      padding: 0.5rem 1rem;
      border: none;
      background: #3498db;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }
    .search-bar button:hover {
      background: #2980b9;
    }

    /* Form section styles */
    .form-section {
      margin-top: 1rem;
      max-width: 600px;
      background: #fafafa;
      border: 1px solid #ddd;
      padding: 1rem;
      border-radius: 8px;
    }
    .form-section h2 {
      margin-bottom: 1rem;
      text-align: center;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .form-group textarea {
      resize: vertical;
    }
    .form-section button {
      background: #2ecc71;
      color: #fff;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .form-section button:hover {
      background: #27ae60;
    }
    .info-msg {
      color: green;
      margin-top: 0.5rem;
      min-height: 1.2rem;
    }
    pre {
      background: #eee;
      padding: 0.5rem;
      border-radius: 4px;
      white-space: pre-wrap;
    }

    /* Items list */
    .item-list {
      margin-top: 1rem;
    }
    .item {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .item h3 {
      margin-bottom: 0.4rem;
      color: #333;
    }
    .item .icon-buttons {
      display: inline-flex;
      gap: 8px;
      margin-left: 10px;
    }
    .item .icon-btn {
      cursor: pointer;
      text-decoration: none;
      color: #333;
      font-size: 1rem;
    }
    .item .icon-btn:hover {
      color: #000;
    }

    /* Footer */
    footer {
      background-color: #2c3e50;
      color: #ecf0f1;
      text-align: center;
      padding: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>My Advanced Snippet App</h1>
  </header>

  <main>
    <!-- Sidebar with category buttons -->
    <div class="sidebar">
      <button onclick="showSection('snippetsSection')">Snippets</button>
      <button onclick="showSection('eaSection')">EA</button>
      <button onclick="showSection('promptSection')">Prompt</button>
    </div>

    <div class="content">
      <!-- SNIPPETS SECTION -->
      <section id="snippetsSection" class="section">
        <h2>Snippets</h2>

        <!-- Search bar for Snippets -->
        <div class="search-bar">
          <input type="text" id="snippetSearchInput" placeholder="Cerca snippet (title, desc, code)..." />
          <button onclick="searchLocalSnippets()">Cerca</button>
        </div>
        <div id="snippetSearchResults"></div>

        <!-- Form for adding a new snippet -->
        <div class="form-section">
          <h2>Inserisci Nuovo Snippet</h2>
          <div class="form-group">
            <label for="title">Titolo</label>
            <input type="text" id="title" />
          </div>
          <div class="form-group">
            <label for="description">Descrizione</label>
            <input type="text" id="description" />
          </div>
          <div class="form-group">
            <label for="code">Codice</label>
            <textarea id="code" rows="5"></textarea>
          </div>
          <button onclick="addSnippet()">Salva Snippet</button>
          <div class="info-msg" id="infoAdd"></div>
        </div>
      </section>

      <!-- EA SECTION -->
      <section id="eaSection" class="section">
        <h2>EA Items</h2>

        <!-- Search bar for EA -->
        <div class="search-bar">
          <input type="text" id="eaSearchInput" placeholder="Cerca EA (title, desc, code, comments)..." />
          <button onclick="searchLocalEA()">Cerca</button>
        </div>
        <div id="eaSearchResults"></div>

        <!-- Form for adding a new EA -->
        <div class="form-section">
          <h2>Inserisci Nuovo EA</h2>
          <div class="form-group">
            <label for="eaTitle">Titolo</label>
            <input type="text" id="eaTitle" />
          </div>
          <div class="form-group">
            <label for="eaDescription">Descrizione</label>
            <input type="text" id="eaDescription" />
          </div>
          <div class="form-group">
            <label for="eaComments">Commenti</label>
            <textarea id="eaComments" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="eaSnippet">Snippet</label>
            <textarea id="eaSnippet" rows="5"></textarea>
          </div>
          <button onclick="addEA()">Salva EA</button>
          <div class="info-msg" id="infoEAAdd"></div>
        </div>
      </section>

      <!-- PROMPT SECTION -->
      <section id="promptSection" class="section">
        <h2>Prompts</h2>

        <!-- Search bar for Prompts -->
        <div class="search-bar">
          <input type="text" id="promptSearchInput" placeholder="Cerca prompt (title, desc)..." />
          <button onclick="searchLocalPrompt()">Cerca</button>
        </div>
        <div id="promptSearchResults"></div>

        <!-- Form for adding a new Prompt -->
        <div class="form-section">
          <h2>Inserisci Nuovo Prompt</h2>
          <div class="form-group">
            <label for="promptTitle">Titolo</label>
            <input type="text" id="promptTitle" />
          </div>
          <div class="form-group">
            <label for="promptDescription">Descrizione</label>
            <input type="text" id="promptDescription" />
          </div>
          <div class="form-group">
            <label for="promptSnippet">Prompt Content</label>
            <textarea id="promptSnippet" rows="5"></textarea>
          </div>
          <button onclick="addPrompt()">Salva Prompt</button>
          <div class="info-msg" id="infoPromptAdd"></div>
        </div>
      </section>

      <!-- SHARED EDIT SECTION (for Snippet, EA, or Prompt) -->
      <div class="form-section section" id="editFormSection">
        <h2>Modifica Elemento</h2>
        <input type="hidden" id="editId" />
        <input type="hidden" id="editType" />
        <div class="form-group">
          <label for="editTitle">Titolo</label>
          <input type="text" id="editTitle" />
        </div>
        <div class="form-group">
          <label for="editDescription">Descrizione</label>
          <input type="text" id="editDescription" />
        </div>
        <div class="form-group" id="editCommentsGroup" style="display: none;">
          <label for="editComments">Commenti (solo EA)</label>
          <textarea id="editComments" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="editCode">Codice/Snippet</label>
          <textarea id="editCode" rows="5"></textarea>
        </div>
        <button onclick="saveEdits()">Salva Modifiche</button>
        <div class="info-msg" id="infoEdit"></div>
      </div>
    </div>
  </main>

  <footer>
    <p>¬© 2025 My Snippet Library</p>
  </footer>

  <!-- Firebase + Firestore imports -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { 
      getFirestore, 
      collection, 
      addDoc, 
      getDocs, 
      doc, 
      updateDoc, 
      deleteDoc 
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY-HERE",
      authDomain: "my-snippet-project-a84b5.firebaseapp.com",
      projectId: "my-snippet-project-a84b5",
      storageBucket: "my-snippet-project-a84b5.firebasestorage.app",
      messagingSenderId: "775794283075",
      appId: "1:775794283075:web:2edd77ebee2f4a4e54baf6"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // We'll store everything in a single array for convenience:
    //  type can be "snippet", "EA", or "prompt"
    let itemArray = [];

    /* ========== UI NAVIGATION ========== */
    window.showSection = function (sectionId) {
      // Hide all "section" elements
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      // Also hide the edit form if it's visible
      document.getElementById('editFormSection').classList.remove('active');

      // Show the requested section
      const target = document.getElementById(sectionId);
      if (target) {
        target.classList.add('active');
      }

      // If needed, load data specifically
      if (sectionId === 'snippetsSection') {
        loadAllData(); // We can re-load everything, then only show snippet's result
        renderSnippets();
      } else if (sectionId === 'eaSection') {
        loadAllData();
        renderEAs();
      } else if (sectionId === 'promptSection') {
        loadAllData();
        renderPrompts();
      }
    };

    /* ========== LOAD DATA (SNIPPETS, EA, PROMPT) ========== */
    async function loadAllData() {
      itemArray = [];

      // Load from "snippets"
      const snippetSnap = await getDocs(collection(db, "snippets"));
      snippetSnap.forEach(docSnap => {
        const data = docSnap.data();
        itemArray.push({
          type: "snippet",
          id: docSnap.id,
          title: data.title || "",
          description: data.description || "",
          code: data.code || "",
          comments: "",
          createdAt: data.createdAt
        });
      });

      // Load from "EA"
      const eaSnap = await getDocs(collection(db, "EA"));
      eaSnap.forEach(docSnap => {
        const data = docSnap.data();
        itemArray.push({
          type: "EA",
          id: docSnap.id,
          title: data.title || "",
          description: data.description || "",
          code: data.snippet || "",
          comments: data.comments || "",
          createdAt: data.createdAt
        });
      });

      // Load from "prompt"
      const promptSnap = await getDocs(collection(db, "prompt"));
      promptSnap.forEach(docSnap => {
        const data = docSnap.data();
        itemArray.push({
          type: "prompt",
          id: docSnap.id,
          title: data.title || "",
          description: data.description || "",
          code: data.snippet || "",
          comments: "",
          createdAt: data.createdAt
        });
      });
    }

    /* ========== RENDERING FUNCTIONS ========== */
    function renderSnippets() {
      const resultsDiv = document.getElementById('snippetSearchResults');
      resultsDiv.innerHTML = "";

      // Filter only snippet type
      const filtered = itemArray.filter(item => item.type === "snippet");
      if (!filtered.length) {
        resultsDiv.innerHTML = "<p>Nessun snippet trovato.</p>";
        return;
      }

      filtered.forEach(snippet => {
        const div = document.createElement('div');
        div.classList.add('item');
        div.innerHTML = `
          <h3>${snippet.title}
            <span class="icon-buttons">
              <span class="icon-btn" title="Copia" onclick="copyItem('${snippet.id}')">üìã</span>
              <span class="icon-btn" title="Modifica" onclick="editItem('${snippet.id}')">‚úèÔ∏è</span>
              <span class="icon-btn" title="Elimina" onclick="deleteItem('${snippet.id}')">üóëÔ∏è</span>
            </span>
          </h3>
          <p><em>${snippet.description}</em></p>
          <pre>${snippet.code}</pre>
        `;
        resultsDiv.appendChild(div);
      });
    }

    function renderEAs() {
      const resultsDiv = document.getElementById('eaSearchResults');
      resultsDiv.innerHTML = "";

      // Filter only EA type
      const filtered = itemArray.filter(item => item.type === "EA");
      if (!filtered.length) {
        resultsDiv.innerHTML = "<p>Nessun EA trovato.</p>";
        return;
      }

      filtered.forEach(ea => {
        const div = document.createElement('div');
        div.classList.add('item');
        div.innerHTML = `
          <h3>${ea.title}
            <span class="icon-buttons">
              <span class="icon-btn" title="Copia" onclick="copyItem('${ea.id}')">üìã</span>
              <span class="icon-btn" title="Modifica" onclick="editItem('${ea.id}')">‚úèÔ∏è</span>
              <span class="icon-btn" title="Elimina" onclick="deleteItem('${ea.id}')">üóëÔ∏è</span>
            </span>
          </h3>
          <p><em>${ea.description}</em></p>
          <p><strong>Commenti:</strong> ${ea.comments}</p>
          <pre>${ea.code}</pre>
        `;
        resultsDiv.appendChild(div);
      });
    }

    function renderPrompts() {
      const resultsDiv = document.getElementById('promptSearchResults');
      resultsDiv.innerHTML = "";

      // Filter only prompt type
      const filtered = itemArray.filter(item => item.type === "prompt");
      if (!filtered.length) {
        resultsDiv.innerHTML = "<p>Nessun Prompt trovato.</p>";
        return;
      }

      filtered.forEach(prompt => {
        const div = document.createElement('div');
        div.classList.add('item');
        div.innerHTML = `
          <h3>${prompt.title}
            <span class="icon-buttons">
              <span class="icon-btn" title="Copia" onclick="copyItem('${prompt.id}')">üìã</span>
              <span class="icon-btn" title="Modifica" onclick="editItem('${prompt.id}')">‚úèÔ∏è</span>
              <span class="icon-btn" title="Elimina" onclick="deleteItem('${prompt.id}')">üóëÔ∏è</span>
            </span>
          </h3>
          <p><em>${prompt.description}</em></p>
          <pre>${prompt.code}</pre>
        `;
        resultsDiv.appendChild(div);
      });
    }

    /* ========== SEARCH FUNCTIONS ========== */
    window.searchLocalSnippets = function() {
      const input = document.getElementById('snippetSearchInput').value.trim().toLowerCase();
      const resultsDiv = document.getElementById('snippetSearchResults');
      resultsDiv.innerHTML = "";

      if (!input) {
        renderSnippets();
        return;
      }

      const filtered = itemArray.filter(item => 
        item.type === "snippet" &&
        (item.title.toLowerCase().includes(input) ||
         (item.description && item.description.toLowerCase().includes(input)) ||
         (item.code && item.code.toLowerCase().includes(input)))
      );

      if (filtered.length === 0) {
        resultsDiv.innerHTML = "<p>Nessun snippet trovato.</p>";
        return;
      }

      filtered.forEach(snippet => {
        const div = document.createElement('div');
        div.classList.add('item');
        div.innerHTML = `
          <h3>${snippet.title}
            <span class="icon-buttons">
              <span class="icon-btn" title="Copia" onclick="copyItem('${snippet.id}')">üìã</span>
              <span class="icon-btn" title="Modifica" onclick="editItem('${snippet.id}')">‚úèÔ∏è</span>
              <span class="icon-btn" title="Elimina" onclick="deleteItem('${snippet.id}')">üóëÔ∏è</span>
            </span>
          </h3>
          <p><em>${snippet.description}</em></p>
          <pre>${snippet.code}</pre>
        `;
        resultsDiv.appendChild(div);
      });
    };

    window.searchLocalEA = function() {
      const input = document.getElementById('eaSearchInput').value.trim().toLowerCase();
      const resultsDiv = document.getElementById('eaSearchResults');
      resultsDiv.innerHTML = "";

      if (!input) {
        renderEAs();
        return;
      }

      const filtered = itemArray.filter(item => 
        item.type === "EA" &&
        (item.title.toLowerCase().includes(input) ||
         (item.description && item.description.toLowerCase().includes(input)) ||
         (item.code && item.code.toLowerCase().includes(input)) ||
         (item.comments && item.comments.toLowerCase().includes(input)))
      );

      if (filtered.length === 0) {
        resultsDiv.innerHTML = "<p>Nessun EA trovato.</p>";
        return;
      }

      filtered.forEach(ea => {
        const div = document.createElement('div');
        div.classList.add('item');
        div.innerHTML = `
          <h3>${ea.title}
            <span class="icon-buttons">
              <span class="icon-btn" title="Copia" onclick="copyItem('${ea.id}')">üìã</span>
              <span class="icon-btn" title="Modifica" onclick="editItem('${ea.id}')">‚úèÔ∏è</span>
              <span class="icon-btn" title="Elimina" onclick="deleteItem('${ea.id}')">üóëÔ∏è</span>
            </span>
          </h3>
          <p><em>${ea.description}</em></p>
          <p><strong>Commenti:</strong> ${ea.comments}</p>
          <pre>${ea.code}</pre>
        `;
        resultsDiv.appendChild(div);
      });
    };

    window.searchLocalPrompt = function() {
      const input = document.getElementById('promptSearchInput').value.trim().toLowerCase();
      const resultsDiv = document.getElementById('promptSearchResults');
      resultsDiv.innerHTML = "";

      if (!input) {
        renderPrompts();
        return;
      }

      const filtered = itemArray.filter(item => 
        item.type === "prompt" &&
        (item.title.toLowerCase().includes(input) ||
         (item.description && item.description.toLowerCase().includes(input)) ||
         (item.code && item.code.toLowerCase().includes(input)))
      );

      if (filtered.length === 0) {
        resultsDiv.innerHTML = "<p>Nessun Prompt trovato.</p>";
        return;
      }

      filtered.forEach(prompt => {
        const div = document.createElement('div');
        div.classList.add('item');
        div.innerHTML = `
          <h3>${prompt.title}
            <span class="icon-buttons">
              <span class="icon-btn" title="Copia" onclick="copyItem('${prompt.id}')">üìã</span>
              <span class="icon-btn" title="Modifica" onclick="editItem('${prompt.id}')">‚úèÔ∏è</span>
              <span class="icon-btn" title="Elimina" onclick="deleteItem('${prompt.id}')">üóëÔ∏è</span>
            </span>
          </h3>
          <p><em>${prompt.description}</em></p>
          <pre>${prompt.code}</pre>
        `;
        resultsDiv.appendChild(div);
      });
    };

    /* ========== ADD NEW ITEMS ========== */
    window.addSnippet = async function () {
      const titleField = document.getElementById('title');
      const descriptionField = document.getElementById('description');
      const codeField = document.getElementById('code');
      const infoAdd = document.getElementById('infoAdd');

      const title = titleField.value.trim();
      const description = descriptionField.value.trim();
      const code = codeField.value.trim();

      if (!title || !code) {
        infoAdd.style.color = "red";
        infoAdd.textContent = "Inserisci almeno un titolo e del codice!";
        return;
      }

      try {
        await addDoc(collection(db, "snippets"), {
          title,
          description,
          code,
          createdAt: new Date(),
        });
        infoAdd.style.color = "green";
        infoAdd.textContent = "Snippet salvato con successo!";
        titleField.value = "";
        descriptionField.value = "";
        codeField.value = "";

        await loadAllData();
        renderSnippets();

      } catch (err) {
        console.error("Errore durante il salvataggio:", err);
        infoAdd.style.color = "red";
        infoAdd.textContent = "Errore durante il salvataggio!";
      }
    };

    window.addEA = async function () {
      const eaTitleField = document.getElementById('eaTitle');
      const eaDescriptionField = document.getElementById('eaDescription');
      const eaCommentsField = document.getElementById('eaComments');
      const eaSnippetField = document.getElementById('eaSnippet');
      const infoEAAdd = document.getElementById('infoEAAdd');

      const eaTitle = eaTitleField.value.trim();
      const eaDescription = eaDescriptionField.value.trim();
      const eaComments = eaCommentsField.value.trim();
      const eaSnippet = eaSnippetField.value.trim();

      if (!eaTitle || !eaSnippet) {
        infoEAAdd.style.color = "red";
        infoEAAdd.textContent = "Inserisci almeno un titolo e uno snippet!";
        return;
      }

      try {
        await addDoc(collection(db, "EA"), {
          title: eaTitle,
          description: eaDescription,
          comments: eaComments,
          snippet: eaSnippet,
          createdAt: new Date(),
        });
        infoEAAdd.style.color = "green";
        infoEAAdd.textContent = "EA salvato con successo!";
        eaTitleField.value = "";
        eaDescriptionField.value = "";
        eaCommentsField.value = "";
        eaSnippetField.value = "";

        await loadAllData();
        renderEAs();

      } catch (err) {
        console.error("Errore durante il salvataggio EA:", err);
        infoEAAdd.style.color = "red";
        infoEAAdd.textContent = "Errore durante il salvataggio EA!";
      }
    };

    window.addPrompt = async function () {
      const promptTitleField = document.getElementById('promptTitle');
      const promptDescriptionField = document.getElementById('promptDescription');
      const promptSnippetField = document.getElementById('promptSnippet');
      const infoPromptAdd = document.getElementById('infoPromptAdd');

      const pTitle = promptTitleField.value.trim();
      const pDescription = promptDescriptionField.value.trim();
      const pSnippet = promptSnippetField.value.trim();

      if (!pTitle || !pSnippet) {
        infoPromptAdd.style.color = "red";
        infoPromptAdd.textContent = "Inserisci almeno un titolo e un contenuto di prompt!";
        return;
      }

      try {
        await addDoc(collection(db, "prompt"), {
          title: pTitle,
          description: pDescription,
          snippet: pSnippet,
          createdAt: new Date(),
        });
        infoPromptAdd.style.color = "green";
        infoPromptAdd.textContent = "Prompt salvato con successo!";
        promptTitleField.value = "";
        promptDescriptionField.value = "";
        promptSnippetField.value = "";

        await loadAllData();
        renderPrompts();

      } catch (err) {
        console.error("Errore durante il salvataggio Prompt:", err);
        infoPromptAdd.style.color = "red";
        infoPromptAdd.textContent = "Errore durante il salvataggio Prompt!";
      }
    };

    /* ========== COPY / EDIT / DELETE ========== */
    function getItemById(id) {
      return itemArray.find(x => x.id === id);
    }

    window.copyItem = function(itemId) {
      const item = getItemById(itemId);
      if (!item) return;

      navigator.clipboard.writeText(item.code || "")
        .then(() => {
          alert("Codice copiato negli appunti!");
        })
        .catch(err => {
          console.error("Errore durante la copia:", err);
        });
    };

    window.editItem = function(itemId) {
      const item = getItemById(itemId);
      if (!item) return;

      // Show the edit form
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById('editFormSection').classList.add('active');

      // Fill hidden fields
      document.getElementById('editId').value = item.id;
      document.getElementById('editType').value = item.type;

      // Fill visible fields
      document.getElementById('editTitle').value = item.title;
      document.getElementById('editDescription').value = item.description;
      document.getElementById('editCode').value = item.code;
      document.getElementById('editComments').value = item.comments || "";

      // Show comments only if EA
      const editCommentsGroup = document.getElementById('editCommentsGroup');
      if (item.type === "EA") {
        editCommentsGroup.style.display = "block";
      } else {
        editCommentsGroup.style.display = "none";
      }
    };

    window.saveEdits = async function() {
      const infoEdit = document.getElementById('infoEdit');
      const editId = document.getElementById('editId').value;
      const editType = document.getElementById('editType').value;
      const newTitle = document.getElementById('editTitle').value.trim();
      const newDescription = document.getElementById('editDescription').value.trim();
      const newCode = document.getElementById('editCode').value.trim();
      const newComments = document.getElementById('editComments').value.trim();

      if (!newTitle || !newCode) {
        infoEdit.style.color = "red";
        infoEdit.textContent = "Titolo e codice/snippet sono obbligatori!";
        return;
      }

      try {
        if (editType === "snippet") {
          await updateDoc(doc(db, "snippets", editId), {
            title: newTitle,
            description: newDescription,
            code: newCode
          });
        } else if (editType === "EA") {
          await updateDoc(doc(db, "EA", editId), {
            title: newTitle,
            description: newDescription,
            snippet: newCode,
            comments: newComments
          });
        } else if (editType === "prompt") {
          await updateDoc(doc(db, "prompt", editId), {
            title: newTitle,
            description: newDescription,
            snippet: newCode
          });
        }

        infoEdit.style.color = "green";
        infoEdit.textContent = "Modifica salvata con successo!";
        await loadAllData();

        // Hide the edit form after a short delay
        setTimeout(() => {
          document.getElementById('editFormSection').classList.remove('active');
          infoEdit.textContent = "";
        }, 800);

      } catch (err) {
        console.error("Errore durante la modifica:", err);
        infoEdit.style.color = "red";
        infoEdit.textContent = "Errore durante la modifica!";
      }
    };

    window.deleteItem = async function(itemId) {
      const item = getItemById(itemId);
      if (!item) return;

      const confirmDelete = confirm("Sei sicuro di voler eliminare?");
      if (!confirmDelete) return;

      try {
        if (item.type === "snippet") {
          await deleteDoc(doc(db, "snippets", item.id));
        } else if (item.type === "EA") {
          await deleteDoc(doc(db, "EA", item.id));
        } else if (item.type === "prompt") {
          await deleteDoc(doc(db, "prompt", item.id));
        }
        alert("Elemento eliminato con successo!");
        await loadAllData();

        // If you're in the snippet section, re-render
        if (item.type === 'snippet') renderSnippets();
        else if (item.type === 'EA') renderEAs();
        else renderPrompts();

      } catch (err) {
        console.error("Errore durante l'eliminazione:", err);
        alert("Errore durante l'eliminazione!");
      }
    };

    // INITIAL LOAD (nothing shown until user clicks a section)
    // If you want to show Snippets by default, uncomment the line below:
    // showSection('snippetsSection');
  </script>
</body>
</html>
